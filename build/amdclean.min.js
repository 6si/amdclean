!function(e,t){"use strict";"function"==typeof define&&define.amd?(t.env="undefined"!=typeof exports?"node":"web",t.amd=!0,define(["esprima","estraverse","escodegen","underscore"],function(n,r,a,i){return t({esprima:n,estraverse:r,escodegen:a,underscore:i},e)})):"undefined"!=typeof exports?(t.env="node",module.exports=t(null,e)):(t.env="web",e.amdclean=t(null,e))}(this,function cleanamd(amdDependencies,scope){"use strict";amdDependencies=amdDependencies||{};var codeEnv=cleanamd.env,that=scope,esprima=function(){return cleanamd.amd&&amdDependencies.esprima&&amdDependencies.esprima.parse?amdDependencies.esprima:that&&that.esprima&&that.esprima.parse?that.esprima:"node"===codeEnv?require("esprima"):void 0}(),estraverse=function(){return cleanamd.amd&&amdDependencies.estraverse&&amdDependencies.estraverse.traverse?amdDependencies.estraverse:that&&that.estraverse&&that.estraverse.traverse?that.estraverse:"node"===codeEnv?require("estraverse"):void 0}(),escodegen=function(){return cleanamd.amd&&amdDependencies.escodegen&&amdDependencies.escodegen.generate?amdDependencies.escodegen:that&&that.escodegen&&that.escodegen.generate?that.escodegen:"node"===codeEnv?require("escodegen"):void 0}(),_=function(){return cleanamd.amd&&amdDependencies.underscore?amdDependencies.underscore:that&&that._?that._:"node"===codeEnv?require("lodash"):void 0}(),fs="node"===codeEnv?require("fs"):{},publicAPI={VERSION:"1.5.0",defaultOptions:{code:"",filePath:"",globalModules:[],globalObject:!1,globalObjectName:"amdclean",esprima:{comment:!0,loc:!0,range:!0,tokens:!0},escodegen:{comment:!0,format:{indent:{adjustMultilineComment:!0}}},commentCleanName:"amdclean",ignoreModules:[],removeModules:[],removeAllRequires:!1,removeUseStricts:!0,transformAMDChecks:!0,shimOverrides:{},rememberGlobalObject:!0,prefixMode:"standard",prefixTransform:function(e){return e},wrap:{start:"",end:""}},env:codeEnv,errorMsgs:{emptyCode:"There is no code to generate the AST with",emptyAst:function(e){return"An AST is not being passed to the "+e+"() method"},invalidObject:function(e){return"An object is not being passed as the first parameter to the "+e+"() method"},lodash:"There is not an _.isPlainObject() method.  Make sure you have included lodash (https://github.com/lodash/lodash).",esprima:"There is not an esprima.parse() method.  Make sure you have included esprima (https://github.com/ariya/esprima).",estraverse:"There is not an estraverse.replace() method.  Make sure you have included estraverse (https://github.com/Constellation/estraverse).",escodegen:"There is not an escodegen.generate() method.  Make sure you have included escodegen (https://github.com/Constellation/escodegen)."},dependencyBlacklist:{require:"remove",exports:!0,module:"remove"},defaultLOC:{start:{line:0,column:0}},defaultRange:[0,0],readFile:function(e){return"node"!==publicAPI.env?"":fs.readFileSync(e,"utf8")},isDefine:function(e){var t=e.expression||{},n=t.callee;return _.isObject(e)&&"ExpressionStatement"===e.type&&_.isObject(t)&&"CallExpression"===t.type&&"Identifier"===n.type&&"define"===n.name},isRequire:function(e){var t=e.expression||{},n=t.callee;return _.isObject(e)&&"ExpressionStatement"===e.type&&_.isObject(t)&&"CallExpression"===t.type&&"Identifier"===n.type&&"require"===n.name},isRequireExpression:function(e){return"CallExpression"===e.type&&e.callee&&"require"===e.callee.name},isObjectExpression:function(e){return e&&_.isPlainObject(e)&&"ObjectExpression"===e.type},isFunctionExpression:function(e){return e&&_.isPlainObject(e)&&"FunctionExpression"===e.type},isFunctionCallExpression:function(e){return e&&_.isPlainObject(e)&&"CallExpression"===e.type&&_.isPlainObject(e.callee)&&"FunctionExpression"===e.callee.type},isUseStrict:function(e){return e&&_.isPlainObject(e)&&"Literal"===e.type&&"use strict"===e.value},isAMDConditional:function(e){if(publicAPI.options.transformAMDChecks!==!0||e&&"IfStatement"!==e.type||!_.isObject(e.test)||!_.isObject(e.test.left)||_.isNull(e.test.left.value))return!1;var t={left:{operator:"typeof",argument:{type:"Identifier",name:"define"}},right:{type:"Literal",value:"function"}};return _.where(e.test,t).length||_.where([e.test],t).length||_.where(e.test.left,t).length||_.where([e.test.left],t).length},arrayContains:function(e,t){return _.isArray(e)?-1!==e.indexOf(t):!1},convertToCamelCase:function(e,t){return t=t||"_",e.replace(new RegExp(t+"(.)","g"),function(e,t){return t.toUpperCase()})},prefixReservedWords:function(name){var reservedWord=!1;try{name.length&&eval("var "+name+" = 1;")}catch(e){reservedWord=!0}return reservedWord===!0?"_"+name:name},normalizeModuleName:function(e,t){var n,r,a,i=publicAPI.options.prefixMode,l=publicAPI.options.prefixTransform;return e=e||"","{}"===e?"remove"===publicAPI.dependencyBlacklist[e]?"":e:(n=publicAPI.prefixReservedWords(e.replace(/\./g,"").replace(/[^A-Za-z0-9_$]/g,"_").replace(/^_+/,"")),r="camelCase"===i?publicAPI.convertToCamelCase(n):n,_.isFunction(l)&&(a=l(r,t),_.isString(a)&&a.length)?a:r)},returnExpressionIdentifier:function(e){return{type:"ExpressionStatement",expression:{type:"Identifier",name:e,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC}},convertToObjectDeclaration:function(e,t){var n=(e.node,e.moduleName),r=function(){var n,r,a,i,l,o;return"functionCallExpression"===t&&(n=e.moduleReturnValue,r=n.callee,a=r.params,a&&a.length&&_.isArray(a)&&_.where(a,{name:"global"})&&_.isObject(r.body)&&_.isArray(r.body.body)&&(i=_.where(r.body.body,{type:"ReturnStatement"})[0],_.isObject(i)&&_.isObject(i.argument)&&"FunctionExpression"===i.argument.type&&(o=i.argument,_.isObject(o.body)&&_.isArray(o.body.body)&&(l=_.where(o.body.body,{type:"ReturnStatement"})[0],_.isObject(l.argument)&&_.isObject(l.argument.right)&&_.isObject(l.argument.right.property)&&l.argument.right.property.name&&(n={type:"MemberExpression",computed:!1,object:{type:"Identifier",name:"window",range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},property:{type:"Identifier",name:l.argument.right.property.name,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC}))))),n=n||e.moduleReturnValue}(),a=publicAPI.options,i=function(){return a.globalObject===!0&&a.globalObjectName?{type:"ExpressionStatement",expression:{type:"AssignmentExpression",operator:"=",left:{type:"MemberExpression",computed:!0,object:{type:"Identifier",name:a.globalObjectName,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},property:{type:"Literal",value:n,raw:""+n,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},right:r,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC}:{type:"VariableDeclaration",declarations:[{type:"VariableDeclarator",id:{type:"Identifier",name:n,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},init:r,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC}],kind:"var",range:publicAPI.defaultRange,loc:publicAPI.defaultLOC}}();return i},convertToIIFE:function(e){var t=e.callbackFuncParams,n=e.callbackFunc,r=e.dependencyNames;return{type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"FunctionExpression",id:null,params:t,defaults:[],body:n.body,rest:n.rest,generator:n.generator,expression:n.expression,range:n.range||publicAPI.defaultRange,loc:n.loc||publicAPI.defaultLOC},arguments:r,range:n.range||publicAPI.defaultRange,loc:n.loc||publicAPI.defaultLOC},range:n.range||publicAPI.defaultRange,loc:n.loc||publicAPI.defaultLOC}},convertToIIFEDeclaration:function(e){var t=e.moduleName,n=e.callbackFuncParams,r=e.isOptimized,a=function(){var t=e.callbackFunc;return"Identifier"===t.type&&"undefined"!==t.name&&(t={type:"FunctionExpression",id:null,params:[],defaults:[],body:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:{type:"CallExpression",callee:{type:"Identifier",name:t.name,range:t.range||publicAPI.defaultRange,loc:t.loc||publicAPI.defaultLOC},arguments:n,range:t.range||publicAPI.defaultRange,loc:t.loc||publicAPI.defaultLOC},range:t.range||publicAPI.defaultRange,loc:t.loc||publicAPI.defaultLOC}],range:t.range||publicAPI.defaultRange,loc:t.loc||publicAPI.defaultLOC},rest:null,generator:!1,expression:!1,range:t.range||publicAPI.defaultRange,loc:t.loc||publicAPI.defaultLOC}),t}(),i=e.dependencyNames,l=publicAPI.options,o=function(){return"Literal"===a.type||"Identifier"===a.type&&"undefined"===a.name||r===!0?a:{type:"CallExpression",callee:{type:"FunctionExpression",id:{type:"Identifier",name:"",range:a.range||publicAPI.defaultRange,loc:a.loc||publicAPI.defaultLOC},params:n,defaults:[],body:a.body,rest:a.rest,generator:a.generator,expression:a.expression,range:a.range||publicAPI.defaultRange,loc:a.loc||publicAPI.defaultLOC},arguments:i,range:a.range||publicAPI.defaultRange,loc:a.loc||publicAPI.defaultLOC}}(),u=function(){return l.globalObject===!0&&l.globalObjectName?{type:"ExpressionStatement",expression:{type:"AssignmentExpression",operator:"=",left:{type:"MemberExpression",computed:!0,object:{type:"Identifier",name:l.globalObjectName,range:a.range||publicAPI.defaultRange,loc:a.loc||publicAPI.defaultLOC},property:{type:"Literal",value:t,raw:""+t,range:a.range||publicAPI.defaultRange,loc:a.loc||publicAPI.defaultLOC},range:a.range||publicAPI.defaultRange,loc:a.loc||publicAPI.defaultLOC},right:o,range:a.range||publicAPI.defaultRange,loc:a.loc||publicAPI.defaultLOC},range:a.range||publicAPI.defaultRange,loc:a.loc||publicAPI.defaultLOC}:{type:"VariableDeclaration",declarations:[{type:"VariableDeclarator",id:{type:"Identifier",name:t,range:a.range||publicAPI.defaultRange,loc:a.loc||publicAPI.defaultLOC},init:o,range:a.range||publicAPI.defaultRange,loc:a.loc||publicAPI.defaultLOC}],kind:"var",range:a.range||publicAPI.defaultRange,loc:a.loc||publicAPI.defaultLOC}}();return u},isRelativeFilePath:function(e){var t=e.split("/");return-1!==t.length&&("."===t[0]||".."===t[0])},normalizeDependencyName:function(e,t){if(!e||!t||!publicAPI.isRelativeFilePath(t))return t;var n=function(e){var t,n=e.split("/");return t=_.reduce(n,function(e,t){switch(t){case".":break;case"..":e.pop();break;default:e.push(t)}return e},[]),t.join("/")},r=function(e){var t=e.split("/");return t.pop(),t.join("/")};return n([r(e),t].join("/"))},convertToFunctionExpression:function(e){var t=e.isDefine,n=e.isRequire,r=!1,a=(e.node,e.moduleName),i=e.moduleId,l=e.dependencies,o=l.length,u=publicAPI.options,c=function(){var e,t=[];return _.each(l,function(n){e=publicAPI.normalizeModuleName(publicAPI.normalizeDependencyName(i,n),i),t.push(u.globalObject===!0&&u.globalObjectName&&"{}"!==e?{type:"MemberExpression",computed:!0,object:{type:"Identifier",name:u.globalObjectName,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},property:{type:"Literal",value:e,raw:""+e,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},name:e,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC}:{type:"Identifier",name:e,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC})}),t}(),s=function(){var t,n,a,i,l=e.moduleReturnValue;if(!o&&l&&"FunctionExpression"===l.type&&l.body&&_.isArray(l.body.body)&&l.body.body.length){if(t=_.filter(l.body.body,function(e){return publicAPI.options.removeUseStricts===!0?!publicAPI.isUseStrict(e.expression):e}),n=_.where(t,{type:"ReturnStatement"}),n.length){if(a=n[0],i=a.argument,!publicAPI.isFunctionExpression(a)&&t.length>1||i&&"Identifier"===i.type)return l;l=i,r=!0,l.params&&(o=l.params.length)}}else l&&"FunctionExpression"===l.type&&l.body&&_.isArray(l.body.body)&&0===l.body.body.length&&(l={type:"Identifier",name:"undefined",range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},o=0);return l}(),p=function(){var e=[];return s&&s.body&&_.isArray(s.body.body)&&(e=_.where(s.body.body,{type:"ReturnStatement"}),e.length)?!0:!1}(),d=!1,b=function(){var e,t=[],n=s.params||c||[];return _.each(n,function(n,r){n?e=n.name:(console.log("iterator",r),e=c[r].name),"exports"===e&&(d=!0),"{}"!==e&&"remove"!==publicAPI.dependencyBlacklist[e]&&t.push({type:"Identifier",name:e,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC})}),t}();return!p&&d&&s.body.body.push({type:"ReturnStatement",argument:{type:"Identifier",name:"exports",range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC}),t?publicAPI.convertToIIFEDeclaration({moduleName:a,dependencyNames:c,callbackFuncParams:b,hasExportsParam:d,callbackFunc:s,isOptimized:r}):n?publicAPI.convertToIIFE({dependencyNames:c,callbackFuncParams:b,callbackFunc:s}):void 0},convertDefinesAndRequires:function(e){var t,n,r,a,i,l,o,u,c,s=publicAPI.isDefine(e),p=publicAPI.isRequire(e),d={},b=!1,m="",f=publicAPI.options;if("Program"===e.type&&(u=function(){var t=[];return _.each(e.comments,function(e){var n=e.value.trim();n===f.commentCleanName&&t.push(e)}),t}(),_.each(u,function(e){c=e.loc.start.line,d[c]=!0}),publicAPI.commentLineNumbers=d),o=s||p?e.expression.loc.start.line:e&&e.loc&&e.loc.start?e.loc.start.line:null,publicAPI.commentLineNumbers[o]||publicAPI.commentLineNumbers[""+(parseInt(o,10)-1)])return e;if(publicAPI.isAMDConditional(e))return e.test={type:"Literal",value:!0,raw:"true",range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},e;if(!s&&!p)return"FunctionExpression"===e.type&&_.isArray(e.params)&&_.where(e.params,{type:"Identifier",name:"exports"}).length&&_.isObject(e.body)&&_.isArray(e.body.body)&&!_.where(e.body.body,{type:"ReturnStatement",argument:{type:"Identifier"}}).length&&(e.body.body.unshift({type:"ExpressionStatement",expression:{type:"AssignmentExpression",operator:"=",left:{type:"Identifier",name:"exports",range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},right:{type:"LogicalExpression",operator:"||",left:{type:"Identifier",name:"exports",range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},right:{type:"ObjectExpression",properties:[],range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC}),e.body.body.push({type:"ReturnStatement",argument:{type:"Identifier",name:"exports",range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC})),e;if(n=Array.prototype.slice.call(e.expression.arguments,0),r=function(){var e=p?n[0]:n[n.length-2],t=[];return e=_.isPlainObject(e)?e.elements||[]:[],Array.isArray(e)&&e.length&&_.each(e,function(e){"remove"!==publicAPI.dependencyBlacklist[e.value]&&(publicAPI.dependencyBlacklist[e.value]?"remove"!==publicAPI.dependencyBlacklist[e.value]&&t.push("{}"):t.push(e.value))}),t}(),a=p?n[1]:n[n.length-1],i=e.expression.arguments[0].value,t=publicAPI.normalizeModuleName(i),l={node:e,moduleName:t,moduleId:i,dependencies:r,moduleReturnValue:a,isDefine:s,isRequire:p},s){if(publicAPI.arrayContains(f.removeModules,t))return{type:"EmptyStatement"};if(_.isObject(f.shimOverrides)&&f.shimOverrides[t]&&(l.moduleReturnValue=publicAPI.createAst({code:f.shimOverrides[t]}),_.isArray(l.moduleReturnValue.body)&&_.isObject(l.moduleReturnValue.body[0])?_.isObject(l.moduleReturnValue.body[0].expression)&&(l.moduleReturnValue=l.moduleReturnValue.body[0].expression,m="objectExpression"):l.moduleReturnValue=a),l.moduleReturnValue&&"Identifier"===l.moduleReturnValue.type&&(m="functionExpression"),publicAPI.arrayContains(f.ignoreModules,t))return e;if(publicAPI.isFunctionExpression(a)||"functionExpression"===m)return publicAPI.convertToFunctionExpression(l);if(publicAPI.isObjectExpression(a)||"objectExpression"===m)return publicAPI.convertToObjectDeclaration(l);if(publicAPI.isFunctionCallExpression(a))return publicAPI.convertToObjectDeclaration(l,"functionCallExpression")}else if(p)return b=_.isArray(e.expression.arguments)&&e.expression.arguments.length?e.expression.arguments[1]&&e.expression.arguments[1].body&&e.expression.arguments[1].body.body&&e.expression.arguments[1].body.body.length:!1,f.removeAllRequires!==!0&&b?publicAPI.convertToFunctionExpression(l):{type:"EmptyStatement"}},createAst:function(e){var t=e.filePath,n=e.code||(t&&"node"===publicAPI.env?publicAPI.readFile(t):""),r=publicAPI.options.esprima;if(n){if(!_.isPlainObject(esprima)||!_.isFunction(esprima.parse))throw new Error(publicAPI.errorMsgs.esprima);return esprima.parse(n,r)}throw new Error(publicAPI.errorMsgs.emptyCode)},traverseAndUpdateAst:function(e){if(!_.isPlainObject(e))throw new Error(publicAPI.errorMsgs.invalidObject("traverseAndUpdateAst"));var t=e.ast,n=function(e,t){return publicAPI.convertDefinesAndRequires(e,t)},r=function(e){return e},a=_.isFunction(e.enterFunc)?e.enterFunc:n,i=_.isFunction(e.leaveFunc)?e.leaveFunc:r;if(!t)throw new Error(publicAPI.errorMsgs.emptyAst("traverseAndUpdateAst"));if(!_.isPlainObject(estraverse)||!_.isFunction(estraverse.replace))throw new Error(publicAPI.errorMsgs.estraverse);return estraverse.replace(t,{enter:a,leave:i}),t},generateCode:function(e,t){var n=t.esprima||{},r=t.escodegen||{};if(!_.isPlainObject(escodegen)||!_.isFunction(escodegen.generate))throw new Error(publicAPI.errorMsgs.escodegen);if(n.comment===!0&&r.comment===!0)try{e=escodegen.attachComments(e,e.comments,e.tokens)}catch(a){console&&console.log&&console.log("There was an error attaching comments: ",a)}return escodegen.generate(e,r)},clean:function(e){var t,n={},r={},a={},i=_.cloneDeep(publicAPI.defaultOptions||{}),l=e||{},o=_.merge(i,l);if(publicAPI.options=a=o,!_||!_.isPlainObject)throw new Error(publicAPI.errorMsgs.lodash);if(!_.isPlainObject(e)&&_.isString(e))n.code=e;else{if(!_.isPlainObject(e))throw new Error(publicAPI.errorMsgs.invalidObject("clean"));n=e}return r=publicAPI.traverseAndUpdateAst({ast:publicAPI.createAst(n)}),r&&_.isArray(r.body)&&estraverse.replace(r,{enter:function(e,t){var n;if(void 0===e||"EmptyStatement"===e.type)_.each(t.body,function(e,n){(void 0===e||"EmptyStatement"===e.type)&&t.body.splice(n,1)});else if(publicAPI.isRequireExpression(e))return e.arguments&&e.arguments[0]&&e.arguments[0].value?(n=publicAPI.normalizeModuleName(e.arguments[0].value),a.globalObject===!0&&a.globalObjectName&&_.isString(a.globalObjectName)&&a.globalObjectName.length?{type:"MemberExpression",computed:!0,object:{type:"Identifier",name:a.globalObjectName,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},property:{type:"Literal",value:n,raw:n,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC}:{type:"Identifier",name:n,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC}):e}}),_.isArray(a.globalModules)&&_.each(a.globalModules,function(e){_.isString(e)&&e.length&&r.body.push({type:"ExpressionStatement",expression:{type:"AssignmentExpression",operator:"=",left:{type:"MemberExpression",computed:!1,object:{type:"Identifier",name:"window",range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},property:{type:"Identifier",name:e,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},right:{type:"Identifier",name:e,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC})}),a.globalObject===!0&&a.globalObjectName&&!publicAPI.createdGlobalObject&&(a.rememberGlobalObject===!0&&(publicAPI.createdGlobalObject=!0),r.body.unshift({type:"VariableDeclaration",declarations:[{type:"VariableDeclarator",id:{type:"Identifier",name:a.globalObjectName,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},init:{type:"ObjectExpression",properties:[],range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC}],kind:"var",range:publicAPI.defaultRange,loc:publicAPI.defaultLOC})),t=publicAPI.generateCode(r,a),_.isObject(publicAPI.options.wrap)&&(_.isString(publicAPI.options.wrap.start)&&publicAPI.options.wrap.start.length&&(t=publicAPI.options.wrap.start+t),_.isString(publicAPI.options.wrap.end)&&publicAPI.options.wrap.end.length&&(t+=publicAPI.options.wrap.end)),t}};return publicAPI});