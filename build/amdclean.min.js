!function(e,n){"use strict";"function"==typeof define&&define.amd?(n.env="undefined"!=typeof exports?"node":"web",n.amd=!0,define(["esprima","estraverse","escodegen","underscore"],function(t,r,a,i){return n({esprima:t,estraverse:r,escodegen:a,underscore:i},e)})):"undefined"!=typeof exports?(n.env="node",module.exports=n(null,e)):(n.env="web",e.amdclean=n(null,e))}(this,function cleanamd(amdDependencies,scope){"use strict";amdDependencies=amdDependencies||{};var codeEnv=cleanamd.env,that=scope,esprima=function(){return cleanamd.amd&&amdDependencies.esprima&&amdDependencies.esprima.parse?amdDependencies.esprima:that&&that.esprima&&that.esprima.parse?that.esprima:"node"===codeEnv?require("esprima"):void 0}(),estraverse=function(){return cleanamd.amd&&amdDependencies.estraverse&&amdDependencies.estraverse.traverse?amdDependencies.estraverse:that&&that.estraverse&&that.estraverse.traverse?that.estraverse:"node"===codeEnv?require("estraverse"):void 0}(),escodegen=function(){return cleanamd.amd&&amdDependencies.escodegen&&amdDependencies.escodegen.generate?amdDependencies.escodegen:that&&that.escodegen&&that.escodegen.generate?that.escodegen:"node"===codeEnv?require("escodegen"):void 0}(),_=function(){return cleanamd.amd&&amdDependencies.underscore?amdDependencies.underscore:that&&that._?that._:"node"===codeEnv?require("lodash"):void 0}(),fs="node"===codeEnv?require("fs"):{},publicAPI={VERSION:"2.1.0",defaultOptions:{code:"",filePath:"",globalModules:[],esprima:{comment:!0,loc:!0,range:!0,tokens:!0},escodegen:{comment:!0,format:{indent:{adjustMultilineComment:!0}}},commentCleanName:"amdclean",ignoreModules:[],removeModules:[],removeAllRequires:!1,removeUseStricts:!0,transformAMDChecks:!0,shimOverrides:{},prefixMode:"standard",prefixTransform:function(e){return e},wrap:{start:";(function() {",end:"}());"},aggressiveOptimizations:!1},env:codeEnv,errorMsgs:{emptyCode:"There is no code to generate the AST with",emptyAst:function(e){return"An AST is not being passed to the "+e+"() method"},invalidObject:function(e){return"An object is not being passed as the first parameter to the "+e+"() method"},lodash:"There is not an _.isPlainObject() method.  Make sure you have included lodash (https://github.com/lodash/lodash).",esprima:"There is not an esprima.parse() method.  Make sure you have included esprima (https://github.com/ariya/esprima).",estraverse:"There is not an estraverse.replace() method.  Make sure you have included estraverse (https://github.com/Constellation/estraverse).",escodegen:"There is not an escodegen.generate() method.  Make sure you have included escodegen (https://github.com/Constellation/escodegen)."},storedModules:{},callbackParameterMap:{},conditionalModulesToIgnore:{},dependencyBlacklist:{require:"remove",exports:!0,module:"remove"},defaultLOC:{start:{line:0,column:0}},defaultRange:[0,0],readFile:function(e){return"node"!==publicAPI.env?"":fs.readFileSync(e,"utf8")},isDefine:function(e){var n=e.expression||{},t=n.callee;return _.isObject(e)&&"ExpressionStatement"===e.type&&_.isObject(n)&&"CallExpression"===n.type&&"Identifier"===t.type&&"define"===t.name},isRequire:function(e){var n=e.expression||{},t=n.callee;return _.isObject(e)&&"ExpressionStatement"===e.type&&_.isObject(n)&&"CallExpression"===n.type&&"Identifier"===t.type&&"require"===t.name},isModuleExports:function(e){return e?"AssignmentExpression"===e.type&&e.left&&"MemberExpression"===e.left.type&&e.left.object&&"Identifier"===e.left.object.type&&"module"===e.left.object.name&&e.left.property&&"Identifier"===e.left.property.type&&"exports"===e.left.property.name:!1},isRequireExpression:function(e){return"CallExpression"===e.type&&e.callee&&"require"===e.callee.name},isObjectExpression:function(e){return e&&_.isPlainObject(e)&&"ObjectExpression"===e.type},isFunctionExpression:function(e){return e&&_.isPlainObject(e)&&"FunctionExpression"===e.type},isFunctionCallExpression:function(e){return e&&_.isPlainObject(e)&&"CallExpression"===e.type&&_.isPlainObject(e.callee)&&"FunctionExpression"===e.callee.type},isUseStrict:function(e){return e&&_.isPlainObject(e)&&"Literal"===e.type&&"use strict"===e.value},isAMDConditional:function(e){if(e&&"IfStatement"!==e.type||!_.isObject(e.test)||!_.isObject(e.test.left)||_.isNull(e.test.left.value))return!1;var n={left:{operator:"typeof",argument:{type:"Identifier",name:"define"}},right:{type:"Literal",value:"function"}};return _.where(e.test,n).length||_.where([e.test],n).length||_.where(e.test.left,n).length||_.where([e.test.left],n).length},convertToCamelCase:function(e,n){return n=n||"_",e.replace(new RegExp(n+"(.)","g"),function(e,n){return n.toUpperCase()})},prefixReservedWords:function(name){var reservedWord=!1;try{name.length&&eval("var "+name+" = 1;")}catch(e){reservedWord=!0}return reservedWord===!0?"_"+name:name},normalizeModuleName:function(e,n){var t,r,a,i=publicAPI.options.prefixMode,l=publicAPI.options.prefixTransform;return e=e||"","{}"===e?"remove"===publicAPI.dependencyBlacklist[e]?"":e:(t=publicAPI.prefixReservedWords(e.replace(/\./g,"").replace(/[^A-Za-z0-9_$]/g,"_").replace(/^_+/,"")),r="camelCase"===i?publicAPI.convertToCamelCase(t):t,_.isFunction(l)&&(a=l(r,n),_.isString(a)&&a.length)?a:r)},returnExpressionIdentifier:function(e){return{type:"ExpressionStatement",expression:{type:"Identifier",name:e,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC}},convertToObjectDeclaration:function(e,n){var t=(e.node,e.moduleName),r=function(){var t,r,a,i,l,o;return"functionCallExpression"===n&&(t=e.moduleReturnValue,r=t.callee,a=r.params,a&&a.length&&_.isArray(a)&&_.where(a,{name:"global"})&&_.isObject(r.body)&&_.isArray(r.body.body)&&(i=_.where(r.body.body,{type:"ReturnStatement"})[0],_.isObject(i)&&_.isObject(i.argument)&&"FunctionExpression"===i.argument.type&&(o=i.argument,_.isObject(o.body)&&_.isArray(o.body.body)&&(l=_.where(o.body.body,{type:"ReturnStatement"})[0],_.isObject(l.argument)&&_.isObject(l.argument.right)&&_.isObject(l.argument.right.property)&&l.argument.right.property.name&&(t={type:"MemberExpression",computed:!1,object:{type:"Identifier",name:"window",range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},property:{type:"Identifier",name:l.argument.right.property.name,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC}))))),t=t||e.moduleReturnValue}(),a=(publicAPI.options,{type:"ExpressionStatement",expression:{type:"AssignmentExpression",operator:"=",left:{type:"Identifier",name:t,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},right:r,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC});return a},convertToIIFE:function(e){var n=e.callbackFuncParams,t=e.callbackFunc,r=e.dependencyNames;return{type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"FunctionExpression",id:null,params:n,defaults:[],body:t.body,rest:t.rest,generator:t.generator,expression:t.expression,range:t.range||publicAPI.defaultRange,loc:t.loc||publicAPI.defaultLOC},arguments:r,range:t.range||publicAPI.defaultRange,loc:t.loc||publicAPI.defaultLOC},range:t.range||publicAPI.defaultRange,loc:t.loc||publicAPI.defaultLOC}},convertToIIFEDeclaration:function(e){var n=e.moduleName,t=e.callbackFuncParams,r=e.isOptimized,a=function(){var n=e.callbackFunc;return"Identifier"===n.type&&"undefined"!==n.name&&(n={type:"FunctionExpression",id:null,params:[],defaults:[],body:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:{type:"ConditionalExpression",test:{type:"BinaryExpression",operator:"===",left:{type:"UnaryExpression",operator:"typeof",argument:{type:"Identifier",name:n.name,range:n.range||publicAPI.defaultRange,loc:n.loc||publicAPI.defaultLOC},prefix:!0,range:n.range||publicAPI.defaultRange,loc:n.loc||publicAPI.defaultLOC},right:{type:"Literal",value:"function",raw:"'function'",range:n.range||publicAPI.defaultRange,loc:n.loc||publicAPI.defaultLOC},range:n.range||publicAPI.defaultRange,loc:n.loc||publicAPI.defaultLOC},consequent:{type:"CallExpression",callee:{type:"Identifier",name:n.name,range:n.range||publicAPI.defaultRange,loc:n.loc||publicAPI.defaultLOC},arguments:t,range:n.range||publicAPI.defaultRange,loc:n.loc||publicAPI.defaultLOC},alternate:{type:"Identifier",name:n.name,range:n.range||publicAPI.defaultRange,loc:n.loc||publicAPI.defaultLOC},range:n.range||publicAPI.defaultRange,loc:n.loc||publicAPI.defaultLOC},range:n.range||publicAPI.defaultRange,loc:n.loc||publicAPI.defaultLOC}],range:n.range||publicAPI.defaultRange,loc:n.loc||publicAPI.defaultLOC},rest:null,generator:!1,expression:!1,range:n.range||publicAPI.defaultRange,loc:n.loc||publicAPI.defaultLOC}),n}(),i=e.dependencyNames,l=(publicAPI.options,function(){return"Literal"===a.type||"Identifier"===a.type&&"undefined"===a.name||r===!0?a:{type:"CallExpression",callee:{type:"FunctionExpression",id:{type:"Identifier",name:"",range:a.range||publicAPI.defaultRange,loc:a.loc||publicAPI.defaultLOC},params:t,defaults:[],body:a.body,rest:a.rest,generator:a.generator,expression:a.expression,range:a.range||publicAPI.defaultRange,loc:a.loc||publicAPI.defaultLOC},arguments:i,range:a.range||publicAPI.defaultRange,loc:a.loc||publicAPI.defaultLOC}}()),o={type:"ExpressionStatement",expression:{type:"AssignmentExpression",operator:"=",left:{type:"Identifier",name:n,range:a.range||publicAPI.defaultRange,loc:a.loc||publicAPI.defaultLOC},right:l,range:a.range||publicAPI.defaultRange,loc:a.loc||publicAPI.defaultLOC},range:a.range||publicAPI.defaultRange,loc:a.loc||publicAPI.defaultLOC};return o},isRelativeFilePath:function(e){var n=e.split("/");return-1!==n.length&&("."===n[0]||".."===n[0])},normalizeDependencyName:function(e,n){if(!e||!n||!publicAPI.isRelativeFilePath(n))return n;var t=function(e){var n,t=e.split("/");return n=_.reduce(t,function(e,n){switch(n){case".":break;case"..":e.pop();break;default:e.push(n)}return e},[]),n.join("/")},r=function(e){var n=e.split("/");return n.pop(),n.join("/")};return t([r(e),n].join("/"))},convertToFunctionExpression:function(e){var n,t,r,a=e.isDefine,i=e.isRequire,l=!1,o=(e.node,e.moduleName),u=e.moduleId,s=e.dependencies,c=s.length,p=publicAPI.options,d=p.aggressiveOptimizations,m=[],b=[],f=function(){var n,t,r,a,i=e.moduleReturnValue;if(i&&"FunctionExpression"===i.type&&i.body&&_.isArray(i.body.body)&&i.body.body.length){if(n=_.filter(i.body.body,function(e){return publicAPI.options.removeUseStricts===!0?!publicAPI.isUseStrict(e.expression):e}),t=_.where(n,{type:"ReturnStatement"}),m=_.where(n,{left:{type:"Identifier",name:"exports"}}),b=_.where(n,{left:{type:"MemberExpression",object:{type:"Identifier",name:"module"},property:{type:"Identifier",name:"exports"}}}),t.length){if(r=t[0],a=r.argument,!publicAPI.isFunctionExpression(r)&&n.length>1||a&&"Identifier"===a.type)return i;i=a,l=!0,i.params&&(c=i.params.length)}}else i&&"FunctionExpression"===i.type&&i.body&&_.isArray(i.body.body)&&0===i.body.body.length&&(i={type:"Identifier",name:"undefined",range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},c=0);return i}(),g=function(){var e=[];return f&&f.body&&_.isArray(f.body.body)&&(e=_.where(f.body.body,{type:"ReturnStatement"}),e.length)?!0:!1}(),I=function(){var e=f.params||[];return _.where(e,{name:"exports"}).length}(),A={},P=function(){var e,n=[];return _.each(s,function(t){e=publicAPI.normalizeModuleName(publicAPI.normalizeDependencyName(u,t),u),A[e]=!0,n.push({type:"Identifier",name:e,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC})}),n}(),y=function E(e){e="_"+e+"_";var n=function(){var n=!1;return A[e]?n=!0:estraverse.traverse(f,{enter:function(t){"VariableDeclarator"===t.type&&t.id&&"Identifier"===t.id.type&&t.id.name===e&&(n=!0)}}),n}();return n?E(e):e},h=function(){var e=[];return I&&estraverse.traverse(f,{enter:function(n){var t,r;"VariableDeclarator"===n.type&&publicAPI.isRequireExpression(n.init)&&n.id&&n.id.name&&n.init&&n.init.arguments&&n.init.arguments[0]&&n.init.arguments[0].value&&(t=n.id.name,r=publicAPI.normalizeModuleName(n.init.arguments[0].value),t===r&&e.push({originalName:r,newName:y(r)}))}}),e}(),v=function(){var e=[];return _.each(h,function(n){e.push({type:"Identifier",name:n.newName?n.newName:n,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC})}),e}(),x=function(){var e,t=[],r=_.union(f.params||P||[],v),a={};return _.each(r,function(n,r){e=n?n.name:P[r].name,"{}"!==e&&"remove"!==publicAPI.dependencyBlacklist[e]&&(t.push({type:"Identifier",name:e,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC}),d===!0&&!publicAPI.storedModules[e]&&P[r]&&(publicAPI.callbackParameterMap[P[r].name]?(a=_.where(publicAPI.callbackParameterMap[P[r].name],{name:e}),a.length?(a=a[0],a.count+=1):publicAPI.callbackParameterMap[P[r].name].push({name:e,count:1})):publicAPI.callbackParameterMap[P[r].name]=[{name:e,count:1}]))}),n=t,_.filter(t||[],function(e){return d===!0?!publicAPI.storedModules[e.name]:!0})}(),O=!g&&I,R=m.length||b.length;return P=_.filter(P||[],function(e,t){var r=n[t],a=e.name;return d===!0?!r||publicAPI.storedModules[r.name]&&r.name===a?!publicAPI.storedModules[a]:!publicAPI.storedModules[r.name]:!0}),t=P.length,r=x.length,t&&t>r&&P.splice(t-(r||1),r||1),O&&R&&f.body.body.push({type:"ReturnStatement",argument:{type:"Identifier",name:"exports",range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC}),estraverse.replace(f,{enter:function(e){var n,t;return publicAPI.isRequireExpression(e)?e.arguments&&e.arguments[0]&&e.arguments[0].value?(n=publicAPI.normalizeModuleName(e.arguments[0].value),_.where(h,{originalName:n}).length&&(t=_.where(h,{originalName:n})[0].newName),{type:"Identifier",name:t?t:n,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC}):e:void 0}}),a?publicAPI.convertToIIFEDeclaration({moduleName:o,dependencyNames:P,callbackFuncParams:x,hasExportsParam:I,callbackFunc:f,isOptimized:l}):i?publicAPI.convertToIIFE({dependencyNames:P,callbackFuncParams:x,callbackFunc:f}):void 0},getNormalizedModuleName:function(e){if(publicAPI.isDefine(e)){var n=e.expression.arguments[0].value,t=publicAPI.normalizeModuleName(n);return t}},convertDefinesAndRequires:function(e,n){var t,r,a,i,l,o,u,s,c,p,d,m,b=publicAPI.isDefine(e),f=publicAPI.isRequire(e),g={},I=!1,A="",P=publicAPI.options;if("Program"===e.type&&(s=function(){var n=[];return _.each(e.comments,function(e){var t=e.value.trim();t===P.commentCleanName&&n.push(e)}),n}(),_.each(s,function(e){c=e.loc.start.line,g[c]=!0}),publicAPI.commentLineNumbers=g),u=b||f?e.expression.loc.start.line:e&&e.loc&&e.loc.start?e.loc.start.line:null,p=publicAPI.commentLineNumbers[u]||publicAPI.commentLineNumbers[""+(parseInt(u,10)-1)],publicAPI.isAMDConditional(e)){if(!p&&publicAPI.options.transformAMDChecks===!0)return e.test={type:"Literal",value:!0,raw:"true",range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},e;publicAPI.options.transformAMDChecks===!1&&e.consequent&&_.isArray(e.consequent.body)&&e.consequent.body.length&&(d=e.consequent.body[0],d.expression&&d.expression.arguments&&d.expression.arguments.length&&d.expression.arguments[0]&&d.expression.arguments[0].value&&(publicAPI.conditionalModulesToIgnore[d.expression.arguments[0].value]=!0))}if(!b&&!f)return"FunctionExpression"===e.type&&_.isArray(e.params)&&_.where(e.params,{type:"Identifier",name:"exports"}).length&&_.isObject(e.body)&&_.isArray(e.body.body)&&!_.where(e.body.body,{type:"ReturnStatement",argument:{type:"Identifier"}}).length&&(n&&n.arguments&&(m=function(){return n&&_.isArray(n.arguments)?_.where(n.arguments,{type:"FunctionExpression"}).length:!1}()),m&&e.body.body.unshift({type:"ExpressionStatement",expression:{type:"AssignmentExpression",operator:"=",left:{type:"Identifier",name:"exports",range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},right:{type:"LogicalExpression",operator:"||",left:{type:"Identifier",name:"exports",range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},right:{type:"ObjectExpression",properties:[],range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC}),e.body.body.push({type:"ReturnStatement",argument:{type:"Identifier",name:"exports",range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC})),e;if(r=Array.prototype.slice.call(e.expression.arguments,0),a=function(){var e=f?r[0]:r[r.length-2],n=[];return e=_.isPlainObject(e)?e.elements||[]:[],_.isArray(e)&&e.length&&_.each(e,function(e){"remove"!==publicAPI.dependencyBlacklist[e.value]&&(publicAPI.dependencyBlacklist[e.value]?"remove"!==publicAPI.dependencyBlacklist[e.value]&&n.push("{}"):n.push(e.value))}),n}(),i=f?r[1]:r[r.length-1],l=e.expression.arguments[0].value,t=publicAPI.normalizeModuleName(l),o={node:e,moduleName:t,moduleId:l,dependencies:a,moduleReturnValue:i,isDefine:b,isRequire:f},b){if(p||!t||publicAPI.conditionalModulesToIgnore[t]===!0)return publicAPI.options.ignoreModules.push(t),e;if(_.contains(P.removeModules,t))return{type:"EmptyStatement"};if(_.isObject(P.shimOverrides)&&P.shimOverrides[t]&&(o.moduleReturnValue=publicAPI.createAst({code:P.shimOverrides[t]}),_.isArray(o.moduleReturnValue.body)&&_.isObject(o.moduleReturnValue.body[0])?_.isObject(o.moduleReturnValue.body[0].expression)&&(o.moduleReturnValue=o.moduleReturnValue.body[0].expression,A="objectExpression"):o.moduleReturnValue=i),o.moduleReturnValue&&"Identifier"===o.moduleReturnValue.type&&(A="functionExpression"),_.contains(P.ignoreModules,t))return e;if(publicAPI.isFunctionExpression(i)||"functionExpression"===A)return publicAPI.convertToFunctionExpression(o);if(publicAPI.isObjectExpression(i)||"objectExpression"===A)return publicAPI.convertToObjectDeclaration(o);if(publicAPI.isFunctionCallExpression(i))return publicAPI.convertToObjectDeclaration(o,"functionCallExpression")}else if(f)return p?e:(I=_.isArray(e.expression.arguments)&&e.expression.arguments.length?e.expression.arguments[1]&&e.expression.arguments[1].body&&e.expression.arguments[1].body.body&&e.expression.arguments[1].body.body.length:!1,P.removeAllRequires!==!0&&I?publicAPI.convertToFunctionExpression(o):{type:"EmptyStatement"})},createAst:function(e){var n=e.filePath,t=e.code||(n&&"node"===publicAPI.env?publicAPI.readFile(n):""),r=publicAPI.options.esprima;if(t){if(!_.isPlainObject(esprima)||!_.isFunction(esprima.parse))throw new Error(publicAPI.errorMsgs.esprima);return esprima.parse(t,r)}throw new Error(publicAPI.errorMsgs.emptyCode)},findAndStoreAllModuleIds:function(e){if(!e)throw new Error(publicAPI.errorMsgs.emptyAst("findAndStoreAllModuleIds"));if(!_.isPlainObject(estraverse)||!_.isFunction(estraverse.traverse))throw new Error(publicAPI.errorMsgs.estraverse);estraverse.traverse(e,{enter:function(e,n){var t=publicAPI.getNormalizedModuleName(e,n);t&&!publicAPI.storedModules[t]&&(publicAPI.storedModules[t]=!0)}})},traverseAndUpdateAst:function(e){if(!_.isPlainObject(e))throw new Error(publicAPI.errorMsgs.invalidObject("traverseAndUpdateAst"));var n=e.ast;if(!n)throw new Error(publicAPI.errorMsgs.emptyAst("traverseAndUpdateAst"));if(!_.isPlainObject(estraverse)||!_.isFunction(estraverse.replace))throw new Error(publicAPI.errorMsgs.estraverse);return estraverse.replace(n,{enter:function(e,n){return publicAPI.convertDefinesAndRequires(e,n)},leave:function(e){return e}}),n},generateCode:function(e,n){var t=n.esprima||{},r=n.escodegen||{};if(!_.isPlainObject(escodegen)||!_.isFunction(escodegen.generate))throw new Error(publicAPI.errorMsgs.escodegen);if(t.comment===!0&&r.comment===!0)try{e=escodegen.attachComments(e,e.comments,e.tokens)}catch(a){console&&console.log&&console.log("There was an error attaching comments: ",a)}return escodegen.generate(e,r)},clean:function(e){var n,t,r={},a={},i={},l=_.cloneDeep(publicAPI.defaultOptions||{}),o=e||{},u=_.merge(l,o),s=[],c={},p={};if(publicAPI.options=i=u,!_||!_.isPlainObject)throw new Error(publicAPI.errorMsgs.lodash);if(!_.isPlainObject(e)&&_.isString(e))r.code=e;else{if(!_.isPlainObject(e))throw new Error(publicAPI.errorMsgs.invalidObject("clean"));r=e}return t=publicAPI.createAst(r),publicAPI.findAndStoreAllModuleIds(t),a=publicAPI.traverseAndUpdateAst({ast:t}),a&&_.isArray(a.body)&&estraverse.replace(a,{enter:function(e,n){var t,r,a,l=e&&e.left&&e.left.name?e.left.name:"",o=e.right,u=[],s={},c=_.filter(publicAPI.callbackParameterMap[l],function(e){return e&&e.count>1}),p=[];if(void 0===e||"EmptyStatement"===e.type)_.each(n.body,function(e,t){(void 0===e||"EmptyStatement"===e.type)&&n.body.splice(t,1)});else{if(publicAPI.isRequireExpression(e))return e.arguments&&e.arguments[0]&&e.arguments[0].value?(t=publicAPI.normalizeModuleName(e.arguments[0].value),{type:"Identifier",name:t,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC}):e;if(publicAPI.isModuleExports(e))return{type:"AssignmentExpression",operator:"=",left:{type:"Identifier",name:"exports"},right:e.right};if(i.aggressiveOptimizations===!0&&"AssignmentExpression"===e.type&&l&&(a=_.map(o&&o.callee&&o.callee.params?o.callee.params:[],function(e){return e.name}),r=_.map(o.arguments,function(e){return e.name}),_.each(r,function(e){_.each(publicAPI.callbackParameterMap[e],function(e){var n=e.name,t=e.count;_.each(a,function(e,r){t>1&&n===e&&p.push(r)})})}),_.each(p,function(e){o.arguments.splice(e,e+1),o.callee.params.splice(e,e+1)}),publicAPI.callbackParameterMap[l]))return e.right=function(){return i.aggressiveOptimizations===!0&&c.length?(u=_.map(c,function(e,n){return{type:"AssignmentExpression",operator:"=",left:{type:"Identifier",name:e.name,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},right:n<c.length-1?{range:publicAPI.defaultRange,loc:publicAPI.defaultLOC}:o,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC}}),s=_.reduce(u,function(e,n){return e.right=n,e}),u.length?s:o):o}(),e}}}),_.isArray(i.globalModules)&&_.each(i.globalModules,function(e){_.isString(e)&&e.length&&a.body.push({type:"ExpressionStatement",expression:{type:"AssignmentExpression",operator:"=",left:{type:"MemberExpression",computed:!1,object:{type:"Identifier",name:"window",range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},property:{type:"Identifier",name:e,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},right:{type:"Identifier",name:e,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},range:publicAPI.defaultRange,loc:publicAPI.defaultLOC})}),p=function(){var e,n={},t=publicAPI.callbackParameterMap;return _.each(t,function(t){_.each(t,function(t){t.count>1&&(e=t.name,n[e]=!0)})}),n}(),c=_.merge(_.cloneDeep(publicAPI.storedModules),p),_.each(c,function(e,n){_.contains(publicAPI.options.ignoreModules,n)||s.push({type:"VariableDeclarator",id:{type:"Identifier",name:n,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC},init:null,range:publicAPI.defaultRange,loc:publicAPI.defaultLOC})}),s.length&&a.body.unshift({type:"VariableDeclaration",declarations:s,kind:"var",range:publicAPI.defaultRange,loc:publicAPI.defaultLOC}),publicAPI.storedModules={},publicAPI.callbackParameterMap={},publicAPI.conditionalModulesToIgnore={},n=publicAPI.generateCode(a,i),_.isObject(publicAPI.options.wrap)&&(_.isString(publicAPI.options.wrap.start)&&publicAPI.options.wrap.start.length&&(n=publicAPI.options.wrap.start+n),_.isString(publicAPI.options.wrap.end)&&publicAPI.options.wrap.end.length&&(n+=publicAPI.options.wrap.end)),n}};return publicAPI});